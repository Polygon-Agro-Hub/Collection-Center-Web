<app-loading-spinner *ngIf="isLoading" />

<div class="flex flex-row items-center gap-5 font-semibold text[#424242] dark:text-white mb-4 mr-5 ml-0 cursor-pointer">
  <p (click)="goBack()" >Assign Targets</p>
  <p>Assign</p>
  
  <!-- <p>Officer Reports</p>  -->
</div>

<div class="w-full px-10 py-7 bg-tileLight dark:bg-[#363636] rounded-lg mb-0">
  <div class="flex flex-col gap-2 items-center justify-center">
    <p class="text-lg font-semibold text-[#292929] mx-3 dark:text-[#FFFFFF]">
      All Orders: {{ ordersArr.length < 10 ? '0' + ordersArr.length : ordersArr.length }}
    </p>
    <p class="text-nrmal font-semibold text-[#292929] mx-3 dark:text-[#FFFFFF]">
      Daily Target for <span class="text-[#415CFF]">{{this.currentDate}}</span>
    </p>
    
  </div>
</div>


<div *ngIf="!isLoading" class="h-screen pt-2 pb-8 rounded-lg">

  <div *ngIf="!hasData"
            class="flex flex-col rounded-lg items-center w-full h-screen px-10 py-7 bg-tileLight dark:bg-[#363636] dark:text-textDark mt-6">
            <p class="text-[#494949] my-6 dark:text-textDark">--No Data Availabale--</p>
            <img src="assets/images/NoData.png" alt="No Data" class="w-20 h-20 dark:text-textDark" />
        </div>

 <div *ngIf="hasData" class="w-full px-10 py-7 bg-tileLight rounded-lg mt-0 dark:bg-[#363636] mb-8 border-gray-100 dark:border-[#202021] border-[2px]">
        <div class="overflow-x-auto mt-8 mr-5 border-gray-100 border-[2px] rounded-lg dark:border-[#202021]" >
            <table class="w-full divide-y-2 overflow-hidden divide-gray-200 dark:divide-[#202021] border-[1px] border-gray-300 dark:border-[#202021]">
                <thead class="  text-[#4B5563] dark:text-gray-300 dark:bg-[#0F0F0F] dark:border-[#202021]">
                    <tr>
                        <th class="px-6 py-3 text-left font-medium">No</th>
                        <th class="px-6 py-3 text-left font-medium">EMP ID</th>
                        <th class="px-6 py-3 text-left font-medium">Full Name</th>
                        <th class="px-6 py-3 text-left font-medium">No of Orders</th>

                    </tr>
                </thead>
                <tbody class="bg-white divide-y-2 divide-gray-200 dark:divide-[#202021] dark:bg-[#1D1D1F]">
                    <tr *ngFor="let item of assignedOrdersArr; let i = index">
                      <td class="px-6 py-4 text-sm text-[#000000] font-medium dark:text-gray-300">
                        {{ (i + 1) < 10 ? '0' + (i + 1) : i + 1 }}
                      </td>
                      <td class="px-6 py-4 text-sm text-[#000000] font-medium dark:text-gray-300">{{ item.empId }}</td>
                      <td class="px-6 py-4 text-sm text-[#000000] font-medium dark:text-gray-300">{{ item.fullName }}</td>
                      <td class="px-6 py-4 text-sm text-[#000000] font-medium dark:text-gray-300"> 
                        <input
                          type="number"
                          [(ngModel)]="item.count"
                          (ngModelChange)="validateTotalCount()"
                          min="0"
                          (keydown)="allowOnlyNumbers($event)"
                          step="1"
                          class="border-[#415CFF] border-[2px] dark:bg-slate-600 border-dotted rounded-lg w-20 px-2 py-1 text-center"
                        />
                      </td>
                    </tr>
                  
                    <!-- Total Orders Row Below "No of Orders" Column -->
                    <tr class="text-sm">
                      <td></td> <!-- Empty cell for 'No' -->
                      <td></td> <!-- Empty cell for 'EMP ID' -->
                      <td class="px-6 py-2 text-right text-[#000000] dark:text-gray-300 font-bold">Total:</td>
                      <td class="px-6 py-4 text-sm text-gray-900 dark:text-gray-300">
                        <input
                          type="number"
                          [value]="totalAssignedOrders"
                          readonly
                          class="border-[#415CFF] border-[2px] border-dotted rounded-lg w-20 px-2 py-1 text-center text-gray-900 dark:text-gray-300 bg-white dark:bg-[#1E293B]"
                        />
                        <i *ngIf="isCountValid && totalOrders !== 0" class="fa-solid fa-circle-check text-blue-600 ml-2 text-lg"></i>
                      </td>
                    </tr>
                  
                    <!-- Validation Message Row -->
                    <tr *ngIf="!isCountValid" class="text-red-500 text-sm">
                      <td colspan="4" class="px-6 py-2 text-center">
                        Total assigned orders should equal to total orders ({{ totalOrders }}).
                      </td>
                    </tr>
                  </tbody>
            </table>
        </div>

        <div class="flex flex-row justify-center items-center my-7 gap-4">
            <button class="bg-[#FFFFFF] text-[#6B7D8C] border-[2px] border-[#95A1AC] rounded-lg px-5 py-2"
                (click)="onCancel()">
                Cancel
            </button>
            <button class="rounded-lg px-7 border-[2px] border-[#95A1AC] py-2"
                [ngClass]="(isCountValid && totalOrders !== 0) ? 'bg-[#415CFF] text-[#FFFFFF]' : 'bg-[#95A1AC] text-[#6B7D8C]'"
                (click)="isCountValid && onSubmit()"
                [disabled]="!isCountValid || totalOrders === 0">
                Save
            </button>
        </div>

    </div>
</div>

<div *ngIf="isExitAssignTarget" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
  <div class="flex flex-col justify-center items-center gap-y-5 bg-white dark:bg-[#363636] shadow-lg rounded-lg p-6 w-1/3">
      <div class="flex items-center justify-center bg-[#F6F7F9] rounded-lg shadow-sm px-4 py-3">
          <i class="fa-solid fa-triangle-exclamation text-[#6B7D8C] text-4xl"></i>
      </div>

      <div class="flex flex-col items-center justify-center text-center">
          <p class="text-[#4B5563] text-lg">You have unsaved changes.</p>
          <p class="text-[#4B5563] text-lg">If you leave this page now, your changes will be lost.</p>
          <p class="text-[#4B5563] text-lg">Do you want to continue without saving?</p>
      </div>

      <div class="flex flex-row items-center justify-center gap-x-4">
          <button (click)="leaveWithoutSaving()"
              class="bg-[#F6F7F9] text-[#4B5563] px-4 py-2 rounded-lg hover:bg-gray-200 flex flex-col items-center justify-center">
              <span class="font-semibold">Leave</span>
              <span>without saving</span>
          </button>

          <button (click)="stayOnPage()"
              class="bg-[#415CFF] text-white px-10 py-2 rounded-lg hover:bg-blue-600 flex flex-col items-center justify-center">
              <span class="font-semibold">Stay</span>
              <span>on page</span>
          </button>
      </div>
  </div>
</div>
